<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>上网 | Flygar&#39;s Blog</title>
    <meta property="og:title" content="上网 - Flygar&#39;s Blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2020-03-06T00:46:30&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2020-03-06T00:46:30&#43;08:00'>
        
    <meta name="Keywords" content="golang,go语言,go,linux">
    <meta name="description" content="上网">
        
    <meta name="author" content="猪一头">
    <meta property="og:url" content="https://flygar.org/2019/03/06/break-wall.html">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    


    
    
</head>


<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="https://flygar.org/">
                        Flygar&#39;s Blog
                    </a>
                
                <p class="description">猪一头</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="https://flygar.org/">首页</a>
                    
                    <a  href="https://flygar.org/archives/" title="归档">归档</a>
                    
                    <a  href="https://flygar.org/about/" title="关于">关于</a>
                    
                    <a  href="https://flygar.org/comment/" title="留言板">留言板</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    
    <article class="post">
        <header>
            <h1 class="post-title">上网</h1>
        </header>
        <date class="post-meta meta-date">
            2020年3月6日
        </date>
        
        <div class="post-meta">
            <span>|</span>
            
            <span class="meta-category"><a href='https://flygar.org/categories/Linux'>Linux</a></span>
            
            <span class="meta-category"><a href='https://flygar.org/categories/Golang'>Golang</a></span>
            
        </div>
        
        
        
        <div class="post-content">
            <p>这篇文章可以写的更好，欢迎到 <a href="https://github.com/haoel/haoel.github.io">https://github.com/haoel/haoel.github.io</a> 更新</p>
<h2 id="0-序">0. 序</h2>
<p>首先，我们先明确一下，我科学上网的目的主要是为了学习、工作、交友、查资料、和丰富自己的眼界，不是为了看黄片，或是干一些非法、政治或是见不得人的事。</p>
<p>对我来说，科学上网很重要，下面罗列一下需要科学上网，我才能真正学习工作和生活的网站：</p>
<ul>
<li>Youtube 和 Vimeo 上的各种大会和教学视频，除了我自己要学，我的孩子也要学。</li>
<li>Wikipedia 维基百科是我目前唯一信得过的百科全书，我在上面可以比较系统地翻阅各种词条。</li>
<li>Slideshare 上有很多的技术文档和资料的PPT，是我的知识学习的地方。</li>
<li>Quora 问答网站，在上面有很多有趣的问答。</li>
<li>博客和论文，很多博客和论文站点都被墙了，比如：Blogspot 和 Medium。</li>
<li>Google 的各种服务，比如：Gmail, Map, Docs，Driver，照片，图片搜索，Voices，论文搜索……包括Google官方的各种技术文档……</li>
<li>一些云服务，比如：Dropbox，IFTTT，Imgur，archive.org……</li>
<li>Twitter 上 Follow 一些牛人和一些官方账号，比如：AWS、Docker……</li>
<li>社交 Facebook, Telegram, Whatsapp，Slack…… 有一些我在国外的亲戚和朋友……</li>
<li>Reddit 是一个聚合网站，一个新闻和文章的集散地，你可以认为是各种频道的今日头条……</li>
<li>Pinterest 和 Instagram  上面有很多不错的图片和视频新闻，是我减压力的地方……</li>
<li>新闻，如BBC。 BBC是全球比较出众的媒体，有太多的有价值资源和内容了，比如纪录片、学英文……</li>
<li>编程，有很多编程的场景需要翻墙，比如，Go语言编程时的 go get 中的很多库是放在 Google的服务器上， 然而Google是全部被墙，包括 Android 和其它一些文档和资源也是一样。包括 SourceForge 的某些项目也需要科学上网，Docker Registry也有部分被墙，还有偶尔抽疯的Github，以及不能访问的gist……</li>
<li>……等等</li>
</ul>
<p>是的，我的互联网不是——全是骗子的百度、充满广告的微信朋友圈、质量低下的公众号、娱乐至死的新浪微博、只有抖机灵和“怎么看XX”的知乎、毫无营养的今日头条…… 在这样的网络空间里，我真的无法生存…… 这根本不是互联网，不是为我服务的互联网，而是在消费我的互联网，是让我变傻变笨的互联网…… 我不能忍，因为它影响到了我的生存……</p>
<h2 id="1-英文能力">1. 英文能力</h2>
<p><strong>首先，你应该对英文读写没什么问题!</strong></p>
<p>为什么这么说？<strong>这主要是针对计算机相关的知识，逻辑是这样的，如果你上了Google还是在用中文关键词，那么你好不容易出来了，结果又回去了，所以没什么意义。</strong> 换言之，科学上网的目的是为了进入广阔的世界范围与全世界的人交流，所以，英文是必备的，如果你英文有问题，VPN过去的用处也不大。</p>
<p>所以，我把这个前提条件放在第一的位置，就是说—— <strong>真正的墙不是GFW，而是人的大脑！</strong> 意思是，屏蔽你获得信息能力的不是墙，而很大一部分则是我们自己的语言能力！</p>
<h2 id="2-购买vps">2. 购买VPS</h2>
<p>然后，你需要一个VPS。</p>
<p>（注：<em>当然，你也可以直接购买一些科学上网的服务，但我这里不推荐了，一方面是广告，另一方面通常这样的服务非常的不稳定，而且也容易被代理方做中间人攻击</em>）</p>
<p><strong>现在你买一台VPS也不贵了，也就是一个月10美金左右（70元），我个人觉得一个月花70元钱不算奢侈的事，而且会让你的生活质量得得改善</strong>。</p>
<p>（注：<em>我现在每个投入在科学上网上的成本大概在不到1000元人民币左右，常备3-5个不同国家的VPS，因为国内的网络路由经常性的变化，所以，为了确保总是有一条快的，所以，得多备几个</em>）。</p>
<h3 id="21-常规vps">2.1 常规VPS</h3>
<p>对于VPS，下面是一些常规选项。</p>
<ul>
<li><a href="https://lightsail.aws.amazon.com/">AWS LightSail</a> 是一个非常便宜好用的服务，最低配置一个月 $3.5 美金，目前的Zone不多，推荐使用日本或新加坡（支持银联卡）</li>
<li><a href="https://aws.amazon.com/cn/">AWS EC2</a>香港、日本或韩国申请个免费试用一年的EC2 VPS （支持银联卡）</li>
<li><a href="https://cloud.google.com/">Google Cloud Platform</a>提供免费试用，赠送300刀赠金（需要国际信用卡）</li>
<li><a href="https://www.linode.com">Linode</a>买个一月USD5刀的VPS</li>
<li><a href="https://www.conoha.jp/zh/">Conoha</a>上买一个日本的VPS，一个月900日元 （可以支付宝）</li>
<li><a href="https://www.vultr.com">Vultr</a>上买一个日本的VPS，一个月5刀 （可以支付宝）</li>
<li><a href="https://www.oracle.com/cloud/free/">Oracle Cloud</a>两台VPS无限期使用，可选美日韩等地（需要国际信用卡）</li>
</ul>
<blockquote>
<p><strong>注意</strong></p>
<ul>
<li>
<p>在中国，因为有太多的网络提供商，所以，国内的网络也是很奇葩的，可以看到的是，不同的地方，不同的网络，到不同的国家完全不一样，而且还经常性地调整路由，所以，经常性地有时候快有时候慢，简直就是随机的。所以，像我这样要求比较高的人，一般会备3-5个不同国家地区的VPS，以保障上网的速度。</p>
</li>
<li>
<p>香港网速应该是比较好的，但是香港的成本也是比较高的。台湾的网速也是不错的，日本的网速其次，新加坡再次之，然后是美国的东海岸（这里是基于北京和上海的情况）</p>
</li>
<li>
<p>日本区的网络质量并不一定很好，有时候快的飞快，但有时候会有很大的丢包率（不同的网络不一样），有时候会很慢。上述的这几个VPS服务商中，AWS韩国和日本会好点，然后是Linode，最后是Conoha和Vultr（如果你有更好的，请推荐）</p>
</li>
<li>
<p>Google Cloud Platform - GCP 的香港和台湾结点也是很快的。但是你要能买GCP的主机，你还得先翻墙，所以，感觉有点死锁了。所以，你可能先用Vultr（按时付费）翻墙，然后再到GCP上购买。</p>
</li>
</ul>
</blockquote>
<h3 id="22-cn2-线路">2.2 CN2 线路</h3>
<p>如果你需要更好更高速的网络服务（比如你要看Youtube的1080P），那么，你需要下面的这些服务器资源了（价格也会高一些）</p>
<p><code>CN2</code> 和 <code>GIA</code> 是两个关键词。<strong>CN2 GIA</strong> 全称 China telecom Next Carrier Network- Global Internet Access 电信国际精品网络，特征是路由线路上骨干节点均为59.43开头的IP。如果想要寻找接入CN2线路的国外VPS提供商，建议使用 <code>Next Carrier Network</code> 或者 <code>CN2</code> 这个关键词搜索即可。</p>
<p>多说一句， CN2本身又分为两种类型：</p>
<ul>
<li>
<p><strong>CN2 GT</strong>: CN2 里属于Global Transit的产品(又名GIS-Global Internet Service)，在CN2里等级低，省级/出国节点为 <code>202.97</code> 开头，国际骨干节点有2～4个 <code>59.43</code> 开头的CN2节点。在出国线路上拥堵程度一般，相对于163骨干网的稍强，相比CN2 GIA，性价比也较高。</p>
</li>
<li>
<p><strong>CN2 GIA</strong>: CN2 里属于Global Internet Access的产品，等级最高，省级/出国/国际骨干节点都以<code>59.43</code>开头，全程没有<code>202.97</code>开头的节点。在出国线路上表现最好，很少拥堵，理论上速度最快最稳定，当然，价格也相对 CN2 GT 偏高。</p>
</li>
</ul>
<p>关于 <code>CN2</code> 线路的主机提供商，下面罗列几个</p>
<ul>
<li><a href="https://bwh8.net/aff.php?aff=39384">搬瓦工</a>  这应该是美区最好的一个用来科学上网的VPS提供商了，实测飞快。购买时你需要注意VPS规格上的 <code>CN2</code> 和 <code>GIA</code> 的描述。（注：点击主页右上角的 <code>regisiter</code> 以后，你可以看到页面上方有两个导航条，在下面的导航条上点 <code>Services</code> -&gt; <code>Order New Services</code> 就可以看到所有的列表了。买完后，你可能需要重装一下操作系统，装成64位带BBR的 ）</li>
<li><a href="https://clientarea.gigsgigscloud.com/index.php?/cart/cloudlet-v-hk/&amp;step=0">Gigsgigscloud</a> CN2 GIA 在香港的结点是很不错的，当然，价格也很不错（建议几个人一起平摊费用）</li>
<li><a href="https://manage.hostdare.com/index.php">Hostdare</a> 的CN2 GIA产品也是三网直连，KVM和OpenVZ两种架构，KVM产品长期缺货</li>
</ul>
<p>更多的可以参考这篇文章《<a href="https://wzfou.com/cn2-gia-vps/">CN2 GIA VPS主机收集整理汇总-电信,联通,移动三网CN2 GIA线路VPS主机</a>》（注：随时间推移，这篇文章的内容可能会失效）</p>
<p>重点说一下，<strong>CN2 GIA + 香港机房</strong>，你会得到巨快无比的上网速度，然而，香港地区的VPS的确是有点贵了。在Youtube.com上看1080p的视频毫无压力。虽然阿里云和腾讯的也有，但是被查到的风险基本上是100%，不建议使用，被抓了别怪我没警告过你。</p>
<h3 id="23-ncp-线路">2.3 NCP 线路</h3>
<p><strong>NCP</strong> 全称 New Cross Pacific（新跨太平洋海底光缆系统）。
2018年11月底，中国到美国之间的海底光缆新开通了NCP线路，并且容量更大（系统设计容量超过80Tbps），路由更少（中国上海到美国中间路由节点只有11个，ping值110ms）。</p>
<p>NCP线路全长13,000公里，连接美国俄勒冈州希尔斯伯勒，连接崇明（中国大陆），南汇（中国大陆），临港（中国大陆），釜山（韩国），头城（台湾），和丸山（日本）。</p>
<p>相对于第二条中美直达海底光缆系统（跨太平洋快线，TPE），现阶段NCP线路的网络流量更少更稳定。特征是华东/中地区流量会经过NCP直达路由节点，IP地址为202.97.95.201/202。</p>
<p>关于 <code>NCP</code> 线路的主机提供商，下面罗列两个（欢迎补充）</p>
<ul>
<li><a href="https://www.50kvm.com">50KVM VPS</a> 截止2018年12月2日KVM 产品最低价格￥81.60/月。</li>
<li><a href="https://t667.com/">OLVPS</a> 截止2018年12月2日KVM 产品最低价格¥22/月。（<strong>特别注意</strong> ： 在 OLVPS 上的《<a href="https://olvps.com/index.php?rp=/knowledgebase/1/TOS.html">服务条款</a>》 中有一条说明：“<strong>禁止OpenV<em>P</em>N/Socks5/PPTP/L2TP等软件、公共代理</strong>”，所以，可能OLPVS并不太适合）</li>
</ul>
<h2 id="3-搭建相关代理服务">3. 搭建相关代理服务</h2>
<blockquote>
<p>注：如下的搭建和安装脚本可参看本库的 scripts 目录下的脚本，如： <a href="https://github.com/haoel/haoel.github.io/blob/master/scripts/install.ubuntu.18.04.sh">Ubuntu 18.04 Installation Script</a> （感谢网友 <a href="https://github.com/gongzili456">@gongzili456</a> 开发）</p>
</blockquote>
<h3 id="31-设置docker服务">3.1 设置Docker服务</h3>
<p>首先，你要安装一个Docker CE 服务，这里你要去看一下docker官方的安装文档：</p>
<ul>
<li><a href="https://docs.docker.com/install/linux/docker-ce/centos/">CentOS 上的 Docker CE 安装</a></li>
<li><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">Ubuntu 上的 Docker CE 安装</a></li>
</ul>
<p>然后开始设置你的VPN/SS服务</p>
<h3 id="32-开启-tcp-bbr-拥塞控制算法">3.2 开启 TCP BBR 拥塞控制算法</h3>
<p>TCP BBR（Bottleneck Bandwidth and Round-trip propagation time）是由Google设计，于2016年发布的拥塞算法。以往大部分拥塞算法是基于丢包来作为降低传输速率的信号，而BBR则基于模型主动探测。该算法使用网络最近出站数据分组当时的最大带宽和往返时间来创建网络的显式模型。数据包传输的每个累积或选择性确认用于生成记录在数据包传输过程和确认返回期间的时间内所传送数据量的采样率。该算法认为随着网络接口控制器逐渐进入千兆速度时，分组丢失不应该被认为是识别拥塞的主要决定因素，所以基于模型的拥塞控制算法能有更高的吞吐量和更低的延迟，可以用BBR来替代其他流行的拥塞算法，例如CUBIC。Google在YouTube上应用该算法，将全球平均的YouTube网络吞吐量提高了4%，在一些国家超过了14%。</p>
<p>BBR之后移植入Linux内核4.9版本，并且对于QUIC可用。</p>
<p>如果开启，请参看 《<a href="https://github.com/iMeiji/shadowsocks_install/wiki/%E5%BC%80%E5%90%AF-TCP-BBR-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E7%AE%97%E6%B3%95">开启TCP BBR拥塞控制算法</a> 》</p>
<h3 id="33-用-gost-设置-https-服务">3.3 用 gost 设置 HTTPS 服务</h3>
<p><a href="https://github.com/ginuerzh/gost">gost</a> 是一个非常强的代理服务，它可以设置成 HTTPS 代理，然后把你的服务伪装成一个Web服务器，<strong>我感觉这比其它的流量伪装更好，也更隐蔽。这也是这里强烈推荐的一个方式</strong>。</p>
<p>为了更为的隐蔽，你需要一个域名，然后使用 <a href="https://letsencrypt.org">Let&rsquo;s Encrypt</a> 来签 一个证书。使用 Let&rsquo;s Encrypt 证书你需要在服务器上安装一个 <a href="https://certbot.eff.org/instructions">certbot</a>，点击 <a href="https://certbot.eff.org/instructions">certbot</a> 这个链接，你可以选择你的服务器，操作系统，然后就跟着指令走吧。</p>
<p>接下来，你需要申请一个证书（我们使用standalone的方式，然后，你需要输入你的电子邮件和你的域名）：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">$ sudo certbot certonly --standalone
</code></pre></div><p>证书默认生成在 <code>/etc/letsencrypt/live/&lt;YOUR.DOMAIN.COM/&gt;</code> 目录下，这个证书90天后就过期了，所以，需要使用一个 cron job 来定期更新（稍后给出）</p>
<p>接下来就是启动 gost 服务了，我们这里还是使用 Docker 的方式建立 gost 服务器。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>
<span style="color:#998;font-style:italic">## 下面的四个参数需要改成你的</span>
<span style="color:#008080">DOMAIN</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;YOU.DOMAIN.NAME&#34;</span>
<span style="color:#008080">USER</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;username&#34;</span>
<span style="color:#008080">PASS</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;password&#34;</span>
<span style="color:#008080">PORT</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">443</span>

<span style="color:#008080">BIND_IP</span><span style="color:#000;font-weight:bold">=</span>0.0.0.0
<span style="color:#008080">CERT_DIR</span><span style="color:#000;font-weight:bold">=</span>/etc/letsencrypt
<span style="color:#008080">CERT</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${</span><span style="color:#008080">CERT_DIR</span><span style="color:#d14">}</span>/live/<span style="color:#d14">${</span><span style="color:#008080">DOMAIN</span><span style="color:#d14">}</span>/fullchain.pem
<span style="color:#008080">KEY</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${</span><span style="color:#008080">CERT_DIR</span><span style="color:#d14">}</span>/live/<span style="color:#d14">${</span><span style="color:#008080">DOMAIN</span><span style="color:#d14">}</span>/privkey.pem
sudo docker run -d --name gost <span style="color:#d14">\
</span><span style="color:#d14"></span>    -v <span style="color:#d14">${</span><span style="color:#008080">CERT_DIR</span><span style="color:#d14">}</span>:<span style="color:#d14">${</span><span style="color:#008080">CERT_DIR</span><span style="color:#d14">}</span>:ro <span style="color:#d14">\
</span><span style="color:#d14"></span>    --net<span style="color:#000;font-weight:bold">=</span>host ginuerzh/gost <span style="color:#d14">\
</span><span style="color:#d14"></span>    -L <span style="color:#d14">&#34;http2://</span><span style="color:#d14">${</span><span style="color:#008080">USER</span><span style="color:#d14">}</span><span style="color:#d14">:</span><span style="color:#d14">${</span><span style="color:#008080">PASS</span><span style="color:#d14">}</span><span style="color:#d14">@</span><span style="color:#d14">${</span><span style="color:#008080">BIND_IP</span><span style="color:#d14">}</span><span style="color:#d14">:</span><span style="color:#d14">${</span><span style="color:#008080">PORT</span><span style="color:#d14">}</span><span style="color:#d14">?cert=</span><span style="color:#d14">${</span><span style="color:#008080">CERT</span><span style="color:#d14">}</span><span style="color:#d14">&amp;key=</span><span style="color:#d14">${</span><span style="color:#008080">KEY</span><span style="color:#d14">}</span><span style="color:#d14">&amp;probe_resist=code:404&#34;</span>
</code></pre></div><p>上面这个脚本，你需要配置：域名(<code>DOMAIN</code>), 用户名 (<code>USER</code>), 密码 (<code>PASS</code>) 和 端口号(<code>PORT</code>) 这几个变量。</p>
<p>关于 gost 的参数， 你可以参看其文档：<a href="https://docs.ginuerzh.xyz/gost/">Gost Wiki</a>，上面我设置一个参数 <code>probe_resist=code:404</code> 意思是，如果服务器被探测，或是用浏览器来访问，返回404错误，也可以返回一个网页（如：<code>probe_resist=file:/path/to/file.txt</code> 或其它网站 <code>probe_resist=web:example.com/page.html</code>）</p>
<p>如无意外，你的服务就启起来了。接下来就是证书的自动化更新。</p>
<p>可以使用命令  <code>crontab -e</code>  来编辑定时任务：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#099">0</span> <span style="color:#099">0</span> <span style="color:#099">1</span> * * /usr/bin/certbot renew --force-renewal
<span style="color:#099">5</span> <span style="color:#099">0</span> <span style="color:#099">1</span> * * /usr/bin/docker restart gost
</code></pre></div><p>这样，服务器就配置完成了。客户端请移动后面的客户端章节。</p>
<h3 id="34-设置shadowsocks服务">3.4 设置Shadowsocks服务</h3>
<p>Shadowsocks 的 Docker 启动脚本 （其中的 <code>SS_PORT</code> 和 <code>SS_PASSWD</code> 需要重新定义一下）</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>
<span style="color:#008080">SS_PORT</span><span style="color:#000;font-weight:bold">=</span><span style="color:#099">1984</span>
<span style="color:#008080">SS_PASSWD</span><span style="color:#000;font-weight:bold">=</span>MyPasswd

sudo docker run -dt --name ss <span style="color:#d14">\
</span><span style="color:#d14"></span>   -p <span style="color:#d14">${</span><span style="color:#008080">SS_PORT</span><span style="color:#d14">}</span>:<span style="color:#d14">${</span><span style="color:#008080">SS_PORT</span><span style="color:#d14">}</span> mritd/shadowsocks <span style="color:#d14">\
</span><span style="color:#d14"></span>   -s <span style="color:#d14">&#34;-s 0.0.0.0 -p </span><span style="color:#d14">${</span><span style="color:#008080">SS_PORT</span><span style="color:#d14">}</span><span style="color:#d14"> -m aes-256-cfb -k </span><span style="color:#d14">${</span><span style="color:#008080">SS_PASSWD</span><span style="color:#d14">}</span><span style="color:#d14"> --fast-open&#34;</span>
</code></pre></div><h3 id="35-设置l2tpipsec服务">3.5 设置L2TP/IPSec服务</h3>
<p>L2TP/IPSec 的启动脚本，其中的三个环境变量 <code>USER</code>， <code>PASS</code> 和 <code>PSK</code> 需要替换一下。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#999;font-weight:bold;font-style:italic">#!/bin/bash
</span><span style="color:#999;font-weight:bold;font-style:italic"></span>
<span style="color:#008080">USER</span><span style="color:#000;font-weight:bold">=</span>someone
<span style="color:#008080">PASS</span><span style="color:#000;font-weight:bold">=</span>password
<span style="color:#008080">PSK</span><span style="color:#000;font-weight:bold">=</span>psk_key

sudo docker run -d  --privileged <span style="color:#d14">\
</span><span style="color:#d14"></span>    -e <span style="color:#008080">PSK</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${</span><span style="color:#008080">PSK</span><span style="color:#d14">}</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>    -e <span style="color:#008080">USERNAME</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${</span><span style="color:#008080">USER</span><span style="color:#d14">}</span> -e <span style="color:#008080">PASSWORD</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">${</span><span style="color:#008080">PASS</span><span style="color:#d14">}</span> <span style="color:#d14">\
</span><span style="color:#d14"></span>    -p 500:500/udp <span style="color:#d14">\
</span><span style="color:#d14"></span>    -p 4500:4500/udp <span style="color:#d14">\
</span><span style="color:#d14"></span>    -p 1701:1701/tcp <span style="color:#d14">\
</span><span style="color:#d14"></span>    -p 1194:1194/udp  <span style="color:#d14">\
</span><span style="color:#d14"></span>    siomiz/softethervpn
</code></pre></div><h3 id="36-设置pptp服务">3.6 设置PPTP服务</h3>
<p>PPTP不安全，请慎重使用</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo docker run -d --privileged --net<span style="color:#000;font-weight:bold">=</span>host 
                -v <span style="color:#000;font-weight:bold">{</span>/path_to_file/chap-secrets<span style="color:#000;font-weight:bold">}</span>:/etc/ppp/chap-secrets <span style="color:#d14">\
</span><span style="color:#d14"></span>                mobtitude/vpn-pptp
</code></pre></div><p>PPTP 使用 <code>/etc/ppp/chap-secrets</code> 文件设置用户名和密码，所以你需要给docker容器提供这个文件，下面是这个文件的示例：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#998;font-style:italic"># Secrets for authentication using PAP</span>
<span style="color:#998;font-style:italic"># client    server      secret           acceptable local IP addresses</span>
  fuckgfw   *           whosyourdaddy    *
</code></pre></div><h2 id="4-客户端设置">4. 客户端设置</h2>
<h3 id="41-gost-客户端">4.1 gost 客户端</h3>
<p>大多数的代理服务都支持 https 的代理，但是我们需要智能代理（也就是该翻的时候翻，不用翻的时候不翻），那么我们可以重用 Shadowsocks 的客户端。</p>
<p>对于电脑来说，你同样可以 <a href="https://github.com/ginuerzh/gost/releases">下载 gost 程序</a>，然后使用下面的命令行：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gost -L ss://aes-128-cfb:passcode@:1984 -F <span style="color:#d14">&#39;https://USER:PASS@DOMAIN:443&#39;</span>
</code></pre></div><p>这样用 gost 在你的本机启动了一个 <code>Shadowsocks</code> 的服务，然后，把请求转到你在上面配置的 HTTPS服务器上，这样就完成转接。</p>
<p>你的ShadowSocks客户端只需要简单的配置一个本机的 SS 配置就好了。</p>
<p>对于手机端，我使用的是iPhone下的 <code>ShadowRocket</code> （需要付费），其中使用 HTTPS 的代理，配置上就好了。</p>
<h3 id="42-shadowsocks-客户端">4.2 Shadowsocks 客户端</h3>
<p>对于 Shadowsocks 客户端，可以到这里查看 <a href="https://shadowsocks.org/en/download/clients.html">Shadowsocks Clients</a></p>
<ul>
<li>MacOS 上你可以下载 <a href="https://github.com/shadowsocks/ShadowsocksX-NG/releases">ShadowsocksX-NG</a></li>
<li>Windows上你可以下载 <a href="https://github.com/shadowsocks/shadowsocks-windows/releases">Shadowsocks-Windows</a>，需要先安装 <a href="https://dotnet.microsoft.com/download/dotnet-framework-runtime">.NET Framework</a></li>
<li>Android的客户端，你可以用手机访问并下载 <a href="https://github.com/shadowsocks/shadowsocks-android/releases">Shadowsocks-Android</a></li>
<li>iPhone 端就比较麻烦了。因为国内全都被下架了。
<ol>
<li>你需要注册一个美国的苹果ID.</li>
<li>然后 iTunes/App Store 用这个美区的ID登录（不是退出iCloud ，而是退出App Store）</li>
<li>然后搜索 <code>Potatso Lite</code> ，<code>ShadowRocket</code>, <code>Wingy</code>, <code>Quantumult</code> 等。（我使用前两个）</li>
</ol>
</li>
</ul>
<blockquote>
<p><strong>注意</strong></p>
<ul>
<li>关于如何注册美区Apple ID账号，你可以参看如下的这几篇文章（我不保证这些文章可不可用，但是你可以自行Google）。
<ul>
<li><a href="https://zhuanlan.zhihu.com/p/36574047">5分钟注册美国区Apple ID（18年亲测有效）</a></li>
<li><a href="https://www.jianshu.com/p/b32da641e849">2018年6月亲测：注册美国地区苹果apple ID帐号终极教程</a></li>
<li><a href="https://blog.csdn.net/ziyuzhiye/article/details/82769129">iOS开发之注册美国Apple Id不需要绑定信用卡，亲测可用</a></li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="43-vpn-客户端">4.3 VPN 客户端</h3>
<p>对于L2TP/IPSec，几乎所有的客户端操作系统（无论是Windows/Mac/Linux的电脑，还是iPhone/Android）都支持，你可以自行Google。</p>
<ul>
<li><a href="https://www.jianshu.com/p/24e48cfb574f">Mac OS X PPTP/L2TP设置教程</a></li>
<li><a href="http://nic.upc.edu.cn/2016/0928/c7809a132077/page.htm">Windows 7操作系统配置L2TP VPN方法</a></li>
</ul>
<h2 id="5-流量伪装和其它方式">5. 流量伪装和其它方式</h2>
<p>无论你用VPN，SS，SSR，都有可能被识别，<strong>只有使用 HTTP over TLS 的样子，才会跟正常的流量混在一起，很难被识别</strong>，所以，目前来说，V2Ray客户端 + Nginx + V2Ray服务端的方式，或是gost的HTTPS的方式，基本上来说，在网络四层上看到的都是TLS的包，很难被识别。这种代理服务只，我觉得只能做探测，或是得到更多的算力来做统计学分析。所以，V2Ray 和 gost 的服务器端用 nginx 再挡一道，那么就很难被发现了。</p>
<blockquote>
<p><strong>注：</strong> 说句老实话，我其时并不想害怕别人知道自己的上什么样的网站，因为我觉得我访问的都是合法的网站，但是就今天这个局势我也没办法——为什么要让像我这样的光明正大的良民搞得跟偷鸡摸狗之徒一样……</p>
</blockquote>
<h3 id="51-v2ray">5.1 V2Ray</h3>
<p>V2Ray 可以配置成一个非常隐蔽的代理软件。</p>
<ul>
<li>V2Ray 用户手册：<a href="https://www.v2ray.com">https://www.v2ray.com</a></li>
<li>V2Ray 项目地址：<a href="https://github.com/v2ray/v2ray-core">https://github.com/v2ray/v2ray-core</a></li>
<li>V2Ray Telegram 使用群链接：<a href="https://t.me/projectv2ray">https://t.me/projectv2ray</a></li>
</ul>
<p>一般来说，祼用 V2Ray 不是一个很好的方式，现在比较流行的是使用nginx来代理，也就是 V2Ray + Websocket + TLS + Nginx，可以参看这篇文章《<a href="https://doubibackup.com/v2ray-ws-tls-nginx.html">V2Ray+WebSocket+TLS+Nginx配置与使用教程</a>》（需要翻墙）。</p>
<p>我个人觉得，配置起来比较复杂，而且环节太多，不如直接用 <code>gost</code> 的 https/http2 的方式配置起来简单，所以，没有放在前面。</p>
<h3 id="52-brook">5.2 Brook</h3>
<p>Brook是一个由 Go语言编写的跨平台代理软件，支持 Linux/MacOS/Windows/Android/iOS 各个平台。</p>
<ul>
<li>Brook Github项目：<a href="https://github.com/txthinking/brook">https://github.com/txthinking/brook</a></li>
<li>Github Wiki教程：<a href="https://github.com/txthinking/brook/wiki/%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E(%E4%B8%AD%E6%96%87)">https://github.com/txthinking/brook/wiki/使用说明(中文)</a></li>
</ul>
<p>服务器一行命令安装：</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/brook.sh <span style="color:#000;font-weight:bold">&amp;&amp;</span> chmod +x brook.sh <span style="color:#000;font-weight:bold">&amp;&amp;</span> bash brook.sh
</code></pre></div><p>运行 <code>brook.sh</code> 会出菜单项，你可以按菜单项来，主要就是设置端口号，密码。很简单的，我这里就不截图了，因为这个脚本运行起来中文菜单式的。</p>
<p>然后你可以在 Brook 项目的 Github 首页上下载不同平台的客户端。设置起来也很简单！</p>
<h2 id="6-针对-ip-被封的解决方案">6. 针对 IP 被封的解决方案</h2>
<p>花钱购买的 VPS 即便做了流量伪装依然有很大的几率 IP 被封锁，大多 VPS 服务商并不提供更换 IP 的服务，使用 CDN 可以让被封锁的 VPS 继续发挥翻墙功能。</p>
<h3 id="61-cloudflare">6.1 Cloudflare</h3>
<p>Cloudflare 是一个 CDN 服务商，目前国内依然能正常的访问，可以作为跳板来实现翻墙。</p>
<p>注册 Cloudflare 帐号，并有一个空闲域名（三级域名即可），交给 Cloudflare 托管并将域名指向被封的 VPS IP，注意开启 Proxied 并且 SSL-TLS 使用 Flexible 选项。</p>
<p>Cloudflare 只需免费方案足以，不必花钱。</p>
<h3 id="62-v2ray">6.2 V2Ray</h3>
<p>VPS 上正常安装并配置好 V2Ray，注意两点:</p>
<ol>
<li>传输协议必须要使用 ws</li>
<li>要使用 80 或者 8080 端口</li>
</ol>
<p>如果端口有其他用途，那么用 Nginx/Caddy 之类软件，做一个 WebSocket proxy 到 V2Ray 即可。</p>
<h3 id="63-补充">6.3 补充</h3>
<p>客户端注意使用网址来连接。</p>
<p>目前支持 WebSocket 的免费 CDN 似乎只有 Cloudflare 一家，国内 CDN 服务商既不支持也不安全，不要考虑了。如果有更好的服务商欢迎补充。</p>
<p>网络延迟比直连增加不少，如果是频繁操作会很痛苦。网络带宽如果运气好可能比直连还优化了，用来看 Youtube 搞不好更流畅。</p>
<h2 id="7-其它">7. 其它</h2>
<h3 id="71-其它方式">7.1 其它方式</h3>
<p>如下还有一些其它的方式（注：均由网友提供，我没有验证过）</p>
<p><a href="https://getoutline.org/en/home">Outline</a> 是由 Google 旗下 <a href="https://jigsaw.google.com/">Jigsaw</a> 团队开发的整套翻墙解决方案。Server 端使用 Shadowsocks，MacOS, Windows, iOS, Android 均有官方客户端。使用 Outline Manager 可以一键配置 DigitalOcean。其他平台例如 AWS, Google Cloud 也提供相应脚本。主要优点就是使用简单并且整个软件栈全部<a href="https://github.com/Jigsaw-Code/?q=outline">开源</a>，有专业团队长期维护。</p>
<h3 id="72-搭建脚本">7.2 搭建脚本</h3>
<p>上述的搭建和安装脚本可参看本库的 scripts 目录下的脚本（感谢网友 <a href="https://github.com/gongzili456">@gongzili456</a> 开发）</p>
<ul>
<li><a href="https://github.com/haoel/haoel.github.io/blob/master/scripts/install.ubuntu.18.04.sh">Ubuntu 18.04 Installation Script</a></li>
</ul>
<p>欢迎补充和改善！</p>
<p>（全文完）</p>
        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>原文作者：</strong><a rel="author" href="https://flygar.org/">猪一头</a></li>
        <li style="word-break:break-all"><strong>原文链接：</strong><a href="https://flygar.org/2019/03/06/break-wall.html">https://flygar.org/2019/03/06/break-wall.html</a></li>
        <li><strong>版权声明：</strong>本作品采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>进行许可，非商业转载请注明出处（作者，原文链接），商业转载请联系作者获得授权。</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/2019/08/26/deploy-elasticsearch-offline.html">离线环境下利用 docker 部署 Elasticsearch 集群</a></li>
        
        <li><a href="/2020/03/05/vps-security.html">vps 安全指北</a></li>
        
        <li><a href="/2020/01/05/linux-bbr.html">Ubuntu 16.04 下启用 TCP BBR 拥塞控制算法</a></li>
        
        <li><a href="/2019/06/17/go-proverbs.html">Go Proverbs</a></li>
        
        <li><a href="/2020/02/01/linux-tips.html">linux tips</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            <ul class="clearfix">
                
                <li><a href='https://flygar.org/tags/Docker'>Docker</a></li>
                
                <li><a href='https://flygar.org/tags/Linux'>Linux</a></li>
                
                <li><a href='https://flygar.org/tags/Go'>Go</a></li>
                
            </ul>
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "flygar/comments"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
</div>

                </div>

                <div id="secondary">
    <section class="widget">
        <form id="search" action='https://flygar.org/search/' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="https://flygar.org/">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>
    
    <section class="widget">
        <h3 class="widget-title">最近文章</h3>
<ul class="widget-list">
    
    <li>
        <a href="https://flygar.org/2020/03/06/pj.html" title="彭剑大傻B">彭剑大傻B</a>
    </li>
    
    <li>
        <a href="https://flygar.org/2019/03/06/break-wall.html" title="上网">上网</a>
    </li>
    
    <li>
        <a href="https://flygar.org/2020/03/05/vps-security.html" title="vps 安全指北">vps 安全指北</a>
    </li>
    
    <li>
        <a href="https://flygar.org/2020/01/05/linux-bbr.html" title="Ubuntu 16.04 下启用 TCP BBR 拥塞控制算法">Ubuntu 16.04 下启用 TCP BBR 拥塞控制算法</a>
    </li>
    
    <li>
        <a href="https://flygar.org/2019/08/26/deploy-elasticsearch-offline.html" title="离线环境下利用 docker 部署 Elasticsearch 集群">离线环境下利用 docker 部署 Elasticsearch 集群</a>
    </li>
    
    <li>
        <a href="https://flygar.org/2019/06/17/go-proverbs.html" title="Go Proverbs">Go Proverbs</a>
    </li>
    
    <li>
        <a href="https://flygar.org/2020/02/01/linux-tips.html" title="linux tips">linux tips</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">福利派送</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://clients.tripodcloud.com/aff.php?aff=528" title="TripodCloud Network" target="_blank" style="color:red">
                
                    <img src="https://i.loli.net/2020/03/05/ukL4SFbdYah12em.png">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">分类</h3>
<ul class="widget-list">
    
    <li><a href="https://flygar.org/categories/Golang/">Golang (2)</a></li>
    
    <li><a href="https://flygar.org/categories/Linux/">Linux (5)</a></li>
    
    <li><a href="https://flygar.org/categories/%E5%A4%A7SB/">大SB (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title">标签</h3>
<div class="tagcloud">
    
    <a href="https://flygar.org/tags/BBR/">BBR</a>
    
    <a href="https://flygar.org/tags/CentOS/">CentOS</a>
    
    <a href="https://flygar.org/tags/Createrepo/">Createrepo</a>
    
    <a href="https://flygar.org/tags/Docker/">Docker</a>
    
    <a href="https://flygar.org/tags/Elasticsearch/">Elasticsearch</a>
    
    <a href="https://flygar.org/tags/Go/">Go</a>
    
    <a href="https://flygar.org/tags/Linux/">Linux</a>
    
    <a href="https://flygar.org/tags/Proverbs/">Proverbs</a>
    
    <a href="https://flygar.org/tags/Ubuntu/">Ubuntu</a>
    
    <a href="https://flygar.org/tags/sb/">sb</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://www.flysnow.org" title="飞雪无情的博客">flysnow</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="https://flygar.org/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
    <footer id="footer">
    <div class="container">
        &copy; 2020 <a href="https://flygar.org/">Flygar&#39;s Blog By 猪一头</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io" target="_blank">Hugo</a>.
        <a href="https://www.flysnow.org/" target="_blank">Theme</a> based on <a href="https://github.com/flysnow-org/maupassant-hugo" target="_blank">maupassant</a>.
        
    </div>
</footer>


    
    <script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>


<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>






</body>

</html>